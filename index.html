<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://drake-bank.com/wp-content/uploads/2020/06/Online-Banking-Icon-150x150.png" type="image/x-icon">
    <title>
       
        CG-banking</title>
    
    <link rel="stylesheet" href="./assets/bootstrap/v5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/fontawesome/v5.15.4/css/all.min.css">
    <link rel="stylesheet" href="./assets/sweetalert2/v11.7.12/sweetalert2.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="./assets/bootstrap/v5.3.0/js/bootstrap.bundle.min.js"></script>
    
</head>
<body>
    
        <div class="container">
            <header>
                <div class="col-lg-6">
                    <h1>List of customer </h1>
                </div>
                <div class="col-lg-6 header-right-button">
                    <a href="#">
                        <button class="btn btn-outline-light">
                            <i class="fas fa-history"></i>
                            Transfer histories
                        </button>
                    </a>
                    <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#modalCreate">
                            <i class="fas fa-user-plus"></i>
                            Add new customer
                    </button>        
                </div>
            </header>

        
            <div class="content">
                <table id="tbCustomer" class="table table-hover">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>FullName</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Balance</th>
                        <th class="text-center">Action</th>
                    </tr>
                    </thead>
                    <tbody >

                    </tbody>
                </table>
            </div>
        
        </div>
       
<!-- Modal create -->

<div class="modal fade" id="modalCreate" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Modal create</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formCreate">
                    <div class="row mb-3">
                        <div class="col-lg-6">
                            <label class="fw-bold">Full Name</label>
                            <input type="text" class="form-control" id="fullNameCreate">
                        </div>
                        <div class="col-lg-6">
                            <label class="fw-bold">Email</label>
                            <input type="email" class="form-control" id="emailCreate">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-lg-6">
                            <label class="fw-bold">Phone</label>
                            <input type="tel" class="form-control" id="phoneCreate">
                        </div>
                        <div class="col-lg-6">
                            <label class="fw-bold">Address</label>
                            <input type="text" class="form-control" id="addressCreate">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnCreate">
                    <i class="fas fa-plus"></i>
                    Create
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Edit -->

<div class="modal fade" id="modalUpdate" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Modal update</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" >
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label class="fw-bold">Full Name</label>
                                <input type="text" class="form-control" id="fullNameUpdate">
                            </div>
                            <div class="col-lg-6">
                                <label class="fw-bold">Email</label>
                                <input type="email" class="form-control" id="emailUpdate">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label class="fw-bold">Phone</label>
                                <input type="tel" class="form-control"id="phoneUpdate">
                            </div>
                            <div class="col-lg-6">
                                <label class="fw-bold">Address</label>
                                <input type="text" class="form-control" id="addressUpdate">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnUpdate">
                        <i class="fas fa-pencil-alt"></i>
                        Save changes
                    </button>
                </div>
            </div>
        </div>
    </div>



<script src="./assets/js/jquery-3.6.0.min.js"></script>
<script src="./assets/sweetalert2/v11.7.12/sweetalert2.all.min.js"></script>
<script src="./assets/js/jquery.number.js"></script>

<script src="./assets/js/app.js"></script>

 
<script>
    let maxId = 1;
const customers = [
    {
        "id": maxId++,
        "fullName": "Thành Nhân",
        "email": "tn@gmail.com",
        "phone": "0987654321",
        "address": "Huế",
        "balance": 10,
        "deleted": 0
    },
    {
        "id": maxId++,
        "fullName": "Nhân Thành",
        "email": "nt@gmail.com",
        "phone": "0123456789",
        "address": "Huế",
        "balance": 5000,
        "deleted": 0
    }
]


function findMaxId(customers) {
    let maxId = 0;
    for (let i = 0; i < customers.length; i++) {
        if (customers[i].id > maxId) {
            maxId = customers[i].id;
        }
    }
    return ++maxId;
}

function renderCustomer(obj) {
    return `<tr>
                <td>${obj.id} </td>
                <td>${obj.fullName} </td>
                <td>${obj.email} </td>
                <td>${obj.phone} </td>
                <td>${obj.address} </td>
                <td>${obj.balance}</td>
                <td class = "text-center">
                    <button  class="btn btn-outline-secondary edit" data-id="${obj.id}" >
                            <i class="far fa-edit"></i>
                    </button>
                    <button  class="btn btn-outline-success deposit" data-id="${obj.id}">
                                <i class="fas fa-plus"></i>
                    </button>
                    <button  class="btn btn-outline-warning withdraw" data-id="${obj.id}">
                            <i class="fa fa-minus"></i>
                    </button>
                    <button  class="btn btn-outline-primary transfer" data-id="${obj.id}">
                            <i class="fas fa-exchange-alt" ></i>
                    </button>
                    <button  class="btn btn-outline-danger delete" data-id="${obj.id}">
                            <i class="fas fa-ban" ></i>
                    </button>
                </td>
            </tr>`;

}

function getAllCustomers() {
    const tbCustomerBody = document.querySelector("#tbCustomer tbody");
    tbCustomerBody.innerHTML = "";
    customers.forEach(item => {
        const str = renderCustomer(item);
        tbCustomerBody.innerHTML += str;
    });
}

getAllCustomers();


// /******************** Create *************************/
function handleCreate() {
    const btnCreate = document.getElementById("btnCreate");
    btnCreate.addEventListener("click", function () {

        let id = findMaxId(customers);
        const fullName = document.getElementById("fullNameCreate").value;
        const email = document.getElementById("emailCreate").value;
        const phone = document.getElementById("phoneCreate").value;
        const address = document.getElementById("addressCreate").value;

        const c = new Customer(id, fullName, email, phone, address, 0, 0);

        customers.push(c);
        getAllCustomers();
        addEventDeleteCustomer();
        addEventShowModalUpdate();
        addEventShowModalDeposit()
        addEventShowModalTransfer()


        let formValue = document.getElementsByClassName("form-control");
        for (var i = 0; i < formValue.length; i++) {
            formValue[i].value = "";
        }
    });
}
handleCreate()

/******************** Find *************************/
function getCustomerById(id) {
    // return customers.find(item => item.id == id);
    for (let i = 0; i < customers.length; i++) {
        if (customers[i].id == id) {
            return customers[i];
        }
    }
    return null;
}

function findCustomerIndexById(id) {
    let index = -1;

    for (let i = 0; i < customers.length; i++) {
        if (customers[i].id === id) {
            index = i;
        }
    }

    return index;
}
/******************** Show Update *************************/

function addEventShowModalUpdate() {
    const btnUpdate = document.querySelectorAll(".edit");
    btnUpdate.forEach((item) => {
        item.addEventListener("click", function () {
            customerId = +item.getAttribute("data-id");
            const customer = getCustomerById(customerId);

            document.getElementById("fullNameUpdate").value = customer.fullName;
            document.getElementById("emailUpdate").value = customer.email;
            document.getElementById("phoneUpdate").value = customer.phone;
            document.getElementById("addressUpdate").value = customer.address;

            const modalUpdate = new bootstrap.Modal(document.getElementById('modalUpdate'), {
                keyboard: false
            })
            modalUpdate.show()
        })
    })
}

addEventShowModalUpdate()

/******************** Update *************************/

function handleUpdateCustomer() {
    const btnUpdate = document.getElementById('btnUpdate');
    btnUpdate.addEventListener('click', function () {

        const fullName = document.getElementById('fullNameUpdate').value;
        const email = document.getElementById('emailUpdate').value;
        const phone = document.getElementById('phoneUpdate').value;
        const address = document.getElementById('addressUpdate').value;
        const c = getCustomerById(customerId);
        const balance = c.balance;
        const customer = {
            id: customerId,
            fullName,
            email,
            phone,
            address,
            balance,
            deleted: 0
        }

        const index = findCustomerIndexById(customerId);

        customers[index] = customer;


        getAllCustomers()



        addEventShowModalUpdate()
        addEventDeleteCustomer()
        addEventShowModalDeposit()
        addEventShowModalTransfer()

        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Cập nhật thành công',
            showConfirmButton: false,
            timer: 1500
        })


    })
}

handleUpdateCustomer()


/******************** Delete *************************/

function addEventDeleteCustomer() {
    const btnDelete = document.querySelectorAll(".delete");

    btnDelete.forEach((item) => {
        item.addEventListener("click", function () {
            customerId = +item.getAttribute("data-id");
            let cf = confirm("Bạn chắc chắn muốn xoá?");
            if (cf) {
                for (var i = 0; i < customers.length; i++) {
                    if (customers[i].id === customerId) {
                        customers.splice(i, 1);
                    }
                }
            }
            getAllCustomers()
            addEventShowModalUpdate()
            addEventDeleteCustomer()
            addEventShowModalDeposit()
            addEventShowModalTransfer()


        });
    });
}

addEventDeleteCustomer()



</script>
</body>
</html>